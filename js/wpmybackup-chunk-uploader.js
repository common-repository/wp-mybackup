var console_print=function(a){return;if(window.console){console.log(a)}};if(!window.console){window.console=function(){return{print:console_print}}}else{window.console.print=console_print}Date.now=Date.now||function(){return +new Date};Number.prototype.padTime=function(){return(this<10?"0":"")+this};Number.prototype.toHMS=function(){var c=Math.floor(this/3600);var a=Math.floor((this-c*3600)/60);var b=Math.floor(this%60);return c.padTime()+":"+a.padTime()+":"+b.padTime()};String.prototype.crc32=function(){var d=function(){var h;var e=[];for(var g=0;g<256;g++){h=g;for(var f=0;f<8;f++){h=((h&1)?(3988292384^(h>>>1)):(h>>>1))}e[g]=h}return e};var a=window.crcTable||(window.crcTable=d());var c=0^(-1);for(var b=0;b<this.length;b++){c=(c>>>8)^a[(c^this.charCodeAt(b))&255]}return(c^(-1))>>>0};if(typeof XMLHttpRequest==="undefined"){XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}throw new Error("This browser does not support XMLHttpRequest.")}}function MyChunkUploader(n){var f=3600;var o=false;this.supported=false;var C=1048576;this.on_chunk_start=null;this.on_upload_progress=null;this.on_ready=null;this.on_error=null;this.on_abort=null;this.on_done=null;var p;var j;var b;var r;var i;var d=false;var w=20;var c=10;var A;var s;var x;var h;var B;var u;var z;var k;var q=("undefined"==typeof n)||(["",null].indexOf()!=-1)?"X-MyChunkUploader":n;var v="Content-Range";var g="Content-Disposition";var a=q+"-Type";var l=q+"-Security-Nonce";var e=q+"-Raw-Post";var m=q+"-Abort";var t=q+"-Timeout";this.options={max_chunk_size:C,raw_post:d,send_interval:w,max_parallel_chunks:c,wait_timeout:f};this.create_xhr=function(G,E){var F=new XMLHttpRequest(),D;F.open("POST",h,true);F.setRequestHeader(q,true);F.setRequestHeader(e,this.options.raw_post);F.setRequestHeader(t,this.options.wait_timeout);if("object"==typeof G){for(D in G){if(G.hasOwnProperty(D)&&-1==[q,e,t].indexOf(D)){F.setRequestHeader(D,G[D])}}}if("string"==typeof E&&!G.hasOwnProperty(l)){F.setRequestHeader(l,E)}return F};this.send_xhr=function(G,D){if("object"!=typeof G){return false}if(true===this.options.raw_post||"object"!=typeof D){if("object"==typeof D){G.send(D.data)}else{G.send()}}else{var F=new FormData(),E;if("object"==typeof D){for(E in D){if(D.hasOwnProperty(E)){F.append(E,D[E])}}}if("object"==typeof z){for(E in z){if(z.hasOwnProperty(E)){F.append(E,z[E])}}}G.send(F);delete F;F=null}return true};var y=function(H){if("object"!=typeof H){return false}var F=null,D={error:false,data:null};try{var E=JSON.parse(H.responseText);D.data=E;if(E.hasOwnProperty("success")){if(!E.success){D.error={message:E.hasOwnProperty("message")?E.message:"unknown"};if(E.hasOwnProperty("code")){D.error.code=E.code}}}}catch(G){D.error={message:H.responseText.length?H.responseText:G.message,code:"get_server_error"}}return D};this.set_server_error=function(E,D){o=D;k=false;if(null!==this.on_error){o.success=false;if(o.hasOwnProperty("json")){o.json.name=B.name}else{o.json={name:B.name}}this.on_error(E,o,"server")}};this.check_is_done=function(F,E){var D=false;if(E.hasOwnProperty("done")&&E.done){if((B.size-i>0)){D={message:"Upload of "+B.name+" failed (sent only "+i+" out of "+B.size+" bytes)",code:"incomplete"}}else{if(null!==this.on_done){D=true;this.on_done(F,s)}}}return D};this.onreadystatechange=function(H){if(!k||o){return}if(H.readyState==4){if(H.status==200){r--;var D=y(H),E=false;if(false!=D){if(null!=D.data){if(D.data.hasOwnProperty("json")){var G=this.check_is_done(H,D.data.json);if("object"==typeof G){E=G}else{k=!G;E=D.error}}}else{E=D.error}}if(false!=E){this.set_server_error(H,E)}else{if(D.data.success&&D.data.json.hasOwnProperty("wait")&&D.data.json.wait){var F=this;setTimeout(function(){var J=F.create_xhr(D.data.json.headers);J.onreadystatechange=function(){F.onreadystatechange(J)};var I=D.data.json.hasOwnProperty("new_nonce")?{action:"upload_restore_file",nonce:D.data.json.new_nonce}:null;F.send_xhr(J,I)},1000*D.data.json.wait)}else{if(null!==this.on_ready){this.on_ready({sent:i,total:B.size,elapsed:b,file:D.data.json})}}}}else{this.set_server_error(H,{message:"Unexpected HTTP error : "+this.statusText,code:H.status})}}};this.upload_slice=function(K){var H;var I="undefined"!=typeof K.options.max_parallel_chunks&&K.options.max_parallel_chunks?K.options.max_parallel_chunks:10;if(false===o&&r<I&&p<B.size){if(p+K.options.max_chunk_size>B.size){H=B.size}else{H=p+K.options.max_chunk_size}var J=p,E=H-1,L=B.size;var F={};F[v]="bytes "+J+"-"+E+"/"+L;F[g]='attachment; filename="'+B.name+'"';F[a]=B.type;var O=K.create_xhr(F);if(null!==K.on_upload_progress){var G=O.upload||O;var N=function(Q,R,S,P){return"function"==typeof Q.addEventListener?Q.addEventListener(R,S,P):Q.attachEvent(R,S)};N(G,"progress",function(R){var T=R.position||R.loaded;var S=R.totalSize||R.total;if(T!=S){return}i+=T;var Q=B.size;var P=Q?Math.round((i/Q)*100):100;if(i){b=(Date.now()-s)/1000;j=b*(Q/i-1);if(j<0){j=0}}K.on_upload_progress({sent:i,total:Q,percentage:P>100?100:P,elapsed:b,eta:j})})}var D=this;O.onreadystatechange=function(){D.onreadystatechange(O)};var M=B.slice(p,H,B.type);K.send_xhr(O,{chunk:M});delete M;M=null;r++;x++;if(null!==K.on_chunk_start){K.on_chunk_start({index:x,range:{from:p,to:H}})}p=H}if(o||p>=B.size){clearInterval(A)}};this.upload_chunked=function(G,F,D,E){if(null==F.toString().match(/object\s+File/i)){throw new TypeError("Argument is not of File type")}s=Date.now();j=0;A=null;o=false;server_error_code=0;p=0;x=0;r=0;i=0;k=true;if(null!=this.on_upload_progress){this.on_upload_progress({sent:0,total:F.size,percentage:0,elapsed:0,eta:0})}h=G;B=F;u=D;z=E;var I="undefined"!=typeof this.options.send_interval&&this.options.send_interval?this.options.send_interval:20;var H=this;A=window.setInterval(function(){H.upload_slice(H)},I)};this.abort=function(G){if(!k){return}o={message:"Aborted by user",code:"UI",json:{name:B.name}};var F={};F[m]=true;F[g]='attachment; filename="'+B.name+'"';var E=this.create_xhr(F);var D=this;E.onreadystatechange=function(){if(this.readyState==4&&null!==D.on_abort){if(this.status==200){try{_server_error=JSON.parse(this.responseText);if(Object.keys(_server_error).length){D.on_abort(this,_server_error);return}}catch(H){o.message+=". "+H.message;o.code="abort"}}else{o.message+=". However, the server abort failed with message :"+this.statusText;o.code=E.status}D.on_abort(this,o)}};this.send_xhr(E,G)};this.supported=window.File&&window.FileReader&&window.FileList&&window.Blob&&(window.Blob.prototype.slice||window.Blob.prototype.webkitSlice||window.Blob.prototype.mozSlice)};