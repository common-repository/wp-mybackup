String.prototype.sprintf=function(){var b,a=this,c=/%(\d)/g;while(b=c.exec(a)){a=a.replace(b[0],arguments[parseInt(b[1])-1])}return a};var isNull=function(b,a){return("undefined"===typeof b||null===b)?a:b};function MyBackupDashboardJS(b,c,a){this.selected_files=null;this.urls=["http://lmgtfy.com/?q=How+do+I+upload+a+file+to+my+server","http://php.net/manual/en/ini.core.php",['<a href="%1#ini.upload-max-filesize" target="_blank">upload_max_filesize</a>','<a href="%1#ini.post-max-size" target="_blank">post_max_size</a>'].join("|")];this.strings={abort_confirm:"Are you sure?",abort_msg:"Aborted by user",restore_btn:"Restore %1 file(s)",remove_btn:"Remove",abort_btn:"Abort",unknown_str:"unknown",error_str:"Error",warning_str:"Warning",file_not_supported:"Either the File, FileReader, FileList or Blob types are not supported by your browser.",file_hint:'You may however restore a file by uploading it <a href="'+this.urls[0]+'" target="_blank">manually</a> to <strong>%1</strong>',formdata_not_supported:"Your browser does not support FormData, therefore the file upload function is disabled.",dragevent_not_supported:"Your browser does not support the DragEvent interface",dragevent_hint1:"You may use the button below to select the file(s).",dragevent_hint2:"either, therefore the drag & drop function is disabled.",size_exceeded_msg:"The size of %1 (%2) exceeds the %3 (%4).",size_exceeded_hint:"Check out the `Upload files in chunks` expert option.",file_select_bug:"The number of selected files (%1) differs from the number of files seen by your browser (%2). Please add one file at a time or use a newer browser."};this.options={chunked_upload:false,max_chunk_size:1048576,raw_post:false,max_parallel_chunks:10,send_interval:20,wait_timeout:3600,dropin_path:"sys-temp-dir/dropin-restore",upload_action:"upload_restore_file",upload_nonce:"",container_class:""};this.on_abort_uploader=function(d){if(!d){d=window.event}if(true===isNull(b.globals.UPLOAD_FILE,false)){d.cancelBubble=true;d.returnValue=this.strings.abort_confirm;if(d.stopPropagation){d.stopPropagation();if(d.preventDefault){d.preventDefault()}else{d.returnValue=false}}}};b._addEventListener(window,"beforeunload",this.on_abort_uploader);this.get_uploader=function(){var g=null;var n=this;var e=function(){var w=document.querySelector(".restore_drag_filelist"),x=w.getElementsByTagName("TR"),v,t=0;for(v=0;x.length>v;v+=1){if(null!==x[v].getAttribute("data-filename")&&0==isNull(x[v].getAttribute("data-error"),0)&&0==isNull(x[v].getAttribute("data-uploading"),0)){t++}}var u=document.getElementById("upload_restore_now");u.style.display=t?"inherit":"none";u.value=n.strings.restore_btn.sprintf(t);w.style.display=x.length?"table":"none"};var o=function(){var t=document.getElementById("select_file_dialog");if(isNull(b.ie,10)<=9){b._addEventListener(t,isNull(b.ie,10)<9?"onchange":"change",function(v){v=v.srcElement;var u=[{name:v.value,size:0,type:"application/octet-stream"}];m(u);v.value=""})}else{t.onchange=function(u){m(u.target.files);u.target.value=""}}t.click()};var i=function(t){var v=document.querySelector(".restore_drag_filelist"),w=v.getElementsByTagName("TR"),u;for(u=0;w.length>u;u+=1){if(w[u].getAttribute("data-filename")&&w[u].getAttribute("data-filename")==t){return w[u]}}return false};var q=function(t){t=t||window.event;t=t.target||t.srcElement;var u=t.parentElement.parentElement;if(0!=isNull(u.getAttribute("data-uploading"),0)){if(confirm(n.strings.abort_confirm)){("function"==typeof g)&&g();t.setAttribute("value",n.strings.remove_btn)}}else{f(u)}};var h=function(y,v,x){if(y){var w=y.querySelector(".row_upload_progress");if(w){w.style.width=v+"%"}var u=y.querySelector(".progress-perc");if(u){u.innerHTML=v+"%"}var t=y.querySelector(".progress-eta");if(t){t.innerHTML="ETA: "+x.toHMS()}}};var r=function(w,v,t){if(w.readyState>3){var D,u,B,y,x;b.globals.UPLOAD_FILE=false;try{console.print(w.responseText);y=JSON.parse(w.responseText)}catch(A){y={json:{name:t,error:true},success:false,message:w.responseText}}D=i(y.json.name);if(false!==D){var z=!y.success||y.json.error?1:0;D.setAttribute("data-error",z);D.removeAttribute("data-uploading");D.querySelector('input[type="button"].button').setAttribute("value",n.strings.remove_btn);u=D.getElementsByTagName("TABLE");u[0].deleteRow(0);B=u[0].insertRow(-1);if(!z){B.style.backgroundColor="#E6FFE6";p(B,y.json.name);p(B,b.getHumanReadableSize(y.json.size));p(B,y.json.type)}else{var C=D.querySelector(".row_upload_progress");if(C){C.setAttribute("class","row_upload_progress_error")}p(B,'<span style="color:red">'+(y.message+(y.hasOwnProperty("code")&&y.code.length?" ("+y.code+")":""))+"</span>",3);B.style.backgroundColor="#FFE6E6";f(D,false)}}e()}};var m=function(D,z){z=isNull(z,false);var B=document.querySelector(".restore_drag_filelist"),w,u;for(w in D){if(D.hasOwnProperty(w)){var v=D[w].hasOwnProperty("json")?D[w].json:D[w];if(b.globals.UNDEFINED!=typeof v.name&&false===i(v.name)){var t=document.createElement("table");var A=document.createElement("div");A.setAttribute("class","row_upload_progress");var E=B.insertRow(-1),y;E.setAttribute("data-filename",v.name);z||E.setAttribute("data-uploading",1);var C=p(E,"");C.style.width="100%";C.appendChild(A);C.appendChild(t);y=t.insertRow(-1);var x=p(y,v.name,null,null,"progress-filename");x=p(y,(100*z)+"%",null,null,"progress-perc");x=p(y,"ETA: "+(z?parseInt("0").toHMS():n.strings.unknown_str),null,null,"progress-eta");C=p(E,"",1,1);u=document.createElement("input");u.setAttribute("type","button");u.setAttribute("class","button");u.setAttribute("value",z?n.strings.remove_btn:n.strings.abort_btn);u.onclick=q;C.appendChild(u);e();k(v,E,r,z)}}}};var j=function(w,x,y){var v=new c(a);if(!v.supported){b.popupError(n.strings.error_str,n.strings.file_not_supported);return false}var u=Date.now();v.options.max_chunk_size=n.options.max_chunk_size;v.options.raw_post=n.options.raw_post;v.options.max_parallel_chunks=n.options.max_parallel_chunks;v.options.send_interval=n.options.send_interval;v.options.wait_timeout=n.options.wait_timeout;v.on_done=function(z,A){console.print("chunk_uploader.on_done");if(y){y(z,A,w.name)}};g=function(){v.abort({action:n.options.upload_action,nonce:n.options.upload_nonce})};v.on_upload_progress=function(z){x=i(w.name);h(x,z.percentage,z.eta)};var t=function(A,z,B){console.print("dashboard on_upload_error");console.print(A);console.print(z);console.print(B);if(y){y({readyState:4,responseText:JSON.stringify(z)},u,w.name)}};v.on_error=t;v.on_abort=t;v.upload_chunked(b.ajaxurl,w,null,{action:n.options.upload_action,nonce:n.options.upload_nonce});return true};var s=function(u,y,z){var w=new FormData();w.append("action",n.options.upload_action);w.append("nonce",n.options.upload_nonce);w.append("file",u);var x={"Content-Disposition":'filename="'+u.name+'"'};var t=Date.now();var v=b.ajaxRequest(b.ajaxurl,w,true,z,null,x);g=function(){v.abort();if(z){var A={json:{name:u.name,error:true},success:false,message:n.strings.abort_msg,code:"UI"};z({readyState:4,responseText:JSON.stringify(A)},t,u.name)}};b._addEventListener(v.upload,"progress",function(D){var A=Math.ceil(D.loaded/D.total*100);var C=Date.now()-t,B=Math.floor(A?C/10/A:0);var E=i(u.name);h(E,A,B)},false);b._addEventListener(v,"load",function(A){console.print("unchunked_uploader.on_load");if(z){z(A.srcElement||A.target,t,u.name)}});return true};var k=function(t,x,y,v){v=isNull(v,false);var u=x.querySelector(".row_upload_progress");b.globals.UPLOAD_FILE=true;u.style.width=0;u.style.display="block";if(v){u.style.width="100%";if(y){y({readyState:4,responseText:JSON.stringify({success:true,json:t})},0,t.name)}return}if(t.size>=b.upload_max_size){if(y){var w=n.strings.size_exceeded_msg.sprintf(t.name,b.getHumanReadableSize(t.size),n.urls[2].sprintf(n.urls[1],n.urls[1]),b.getHumanReadableSize(b.upload_max_size));if(!n.options.chunked_upload){w+=" "+n.strings.size_exceeded_hint}y({readyState:4,responseText:JSON.stringify({success:false,message:w,code:"",json:{name:t.name}})},0,t.name)}return}n.options.chunked_upload&&j(t,x,y)||s(t,x,y)};var f=function(v,u){u=isNull(u,true);var t=v.getAttribute("data-filename"),w=v.parentElement,x;var y=function(B){var A=function(D){b.popupError(n.strings.error_str,D)};try{var z=JSON.parse(B.responseText);if(z.success||0!=v.getAttribute("data-error")){if(u){w.removeChild(v);e()}}else{A(z.message)}}catch(C){A(C.message)}};x="action="+n.options.upload_action+"&nonce="+n.options.upload_nonce+"&delete="+t;b.asyncRunJob(b.ajaxurl,x,null,null,null,4,"_dummy_",-1,y)};var p=function(x,w,y,u,v){y=isNull(y,1);u=isNull(u,x.getElementsByTagName("TD").length);var t=x.insertCell(u);if(y>1){t.colSpan=y}t.innerHTML=w;if(isNull(v,false)){t.setAttribute("class",v)}return t};var l=document.querySelector(".restore_drag_container");b._addEventListener(l,"dragover",function(t){if(t.preventDefault){t.preventDefault()}if(t.stopPropagation){t.stopPropagation()}t.dataTransfer.dropEffect="copy"});b._addEventListener(l,"dragenter",function(t){this.className="restore_drag_container restore_drag_over"});b._addEventListener(l,"dragleave",function(t){this.className="restore_drag_container"});b._addEventListener(l,"drop",function(x){if(x.preventDefault){x.preventDefault()}this.className="restore_drag_container";var w=function(A,z){var y=A.length!=z.length;if(!y){for(var B=0;!y&&B<A.length;B+=1){if(A[B].name!=z[B].name){y=true}}}return y};var u=function(C){var y=[],z;for(var B=0;B<C.types.length;B+=1){z=C.getData(C.types[B]).split("\n");for(var A=0;A<z.length;A+=1){(z[A].length&&y.indexOf(z[A])<0)&&y.push(z[A])}}return y.length};if(isNull(x.dataTransfer.files,false)&&(!n.selected_files||w(n.selected_files,x.dataTransfer.files))){var v=x.dataTransfer.files.length,t=u(x.dataTransfer);if(v<t){b.popupConfirm(n.strings.warning_str,n.strings.file_select_bug.sprintf(t,v),null,{"Got it":null})}n.selected_files=x.dataTransfer.files;m(x.dataTransfer.files)}});var d=function(v){var u=document.querySelector(".restore_drag_filelist"),w=u.children,t,x;for(t=0;w.length>t;t+=1){w[t].parentNode.removeChild(w[t])}var y=function(C){var A=[];try{var z=JSON.parse(C.responseText),B;for(B in z){if(z.hasOwnProperty(B)){A.push(z[B])}}}catch(D){A.push({readyState:4,responseText:JSON.stringify({success:false,message:D.message,code:"",json:{name:""}})})}if(A.length){m(A,true)}e()};v=isNull(v,n.options.upload_nonce);x="action="+n.options.upload_action+"&nonce="+v+"&refresh=1";b.asyncRunJob(b.ajaxurl,x,null,null,null,4,"_dummy_",-1,y)};return{upload_select_files:o,upload_refresh_files:d}};this.init=function(){var g=document.getElementById("drag_error"),d=false,f=false,h=[];if(this.options.chunked_upload){var e=new c(a);d=e.supported;if(!d){h.push(this.strings.file_not_supported)}}else{d=b.globals.UNDEFINED!=typeof FormData;if(!d){h.push(this.strings.formdata_not_supported)}}if(!(f=b.globals.UNDEFINED!=typeof DragEvent)){h.push(this.strings.dragevent_not_supported+(d?this.strings.dragevent_hint1:(" "+this.strings.dragevent_hint2)))}if(g&&!(d&&f)){if(!d){document.querySelector(".restore_drag_container .button-choose-file").disabled=true;h.push(this.strings.file_hint.sprintf(this.options.dropin_path))}g.innerHTML=h.join("<br>");g.setAttribute("class","hintbox "+this.options.container_class);g.style.textAlign="center";g.style.display="block"}this.get_uploader().upload_refresh_files()}};